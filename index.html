import React, { useState, useEffect } from 'react';
import { 
  PenTool, Layout, Calendar as CalendarIcon, Settings, CheckCircle2, Instagram, 
  MessageCircle, Globe, Linkedin, Feather, Sparkles, RefreshCw, 
  Zap, Grid, List, Bold, Italic, AlignLeft, Image as ImageIcon, 
  ChevronLeft, ChevronRight, Search, Plus, Save, Trash2, X, Folder, LogOut, 
  User, Lock, Wand2, Youtube, FileText, Music, Video, PieChart, Download, 
  Shield, Check, FileDown, Key, PlayCircle
} from 'lucide-react';

// --- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã UI ---

const Card = ({ children, className = "", onClick }) => (
  <div 
    onClick={onClick}
    className={`bg-white rounded-2xl border border-slate-100 shadow-sm hover:shadow-lg hover:border-blue-200 transition-all duration-300 ${onClick ? 'cursor-pointer hover:-translate-y-1' : ''} ${className}`}
  >
    {children}
  </div>
);

const Button = ({ children, onClick, variant = "primary", className = "", size = "md", icon: Icon, disabled = false, type = "button" }) => {
  const sizes = {
    sm: "px-3 py-1.5 text-xs",
    md: "px-5 py-2.5 text-sm",
    lg: "px-6 py-3 text-base"
  };
  
  const variants = {
    primary: "bg-blue-600 text-white hover:bg-blue-700 shadow-lg shadow-blue-100 active:scale-95",
    secondary: "bg-white text-slate-700 border border-slate-200 hover:bg-slate-50 hover:border-slate-300 shadow-sm active:scale-95",
    ghost: "text-slate-600 hover:bg-blue-50 hover:text-blue-700 active:scale-95",
    accent: "bg-emerald-500 text-white hover:bg-emerald-600 shadow-lg shadow-emerald-200 active:scale-95",
    danger: "bg-white text-red-600 hover:bg-red-50 border border-red-200 active:scale-95",
  };

  return (
    <button 
      type={type}
      onClick={onClick} 
      disabled={disabled}
      className={`${sizes[size]} font-semibold rounded-xl flex items-center justify-center gap-2 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed disabled:active:scale-100 ${variants[variant]} ${className}`}
    >
      {Icon && <Icon size={size === 'sm' ? 16 : 18} className={disabled && variant !== 'ghost' ? "animate-spin" : ""} />}
      {children}
    </button>
  );
};

const Avatar = ({ name }) => (
  <div className="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-sky-600 text-white flex items-center justify-center text-sm font-bold shadow-md ring-2 ring-white">
    {(name || 'U').substring(0, 2).toUpperCase()}
  </div>
);

const StatusBadge = ({ status }) => {
  const styles = {
    idea: "bg-slate-100 text-slate-600 border-slate-200",
    draft: "bg-amber-50 text-amber-700 border-amber-200",
    review: "bg-blue-50 text-blue-700 border-blue-200",
    scheduled: "bg-emerald-50 text-emerald-700 border-emerald-200",
    published: "bg-purple-50 text-purple-700 border-purple-200"
  };

  const labels = {
    idea: "–ò–¥–µ—è",
    draft: "–ß–µ—Ä–Ω–æ–≤–∏–∫",
    review: "–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ",
    scheduled: "–í –ø–ª–∞–Ω–µ",
    published: "–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ"
  };

  return (
    <span className={`px-2.5 py-1 rounded-md text-[10px] font-bold border uppercase tracking-wider ${styles[status] || styles.idea}`}>
      {labels[status]}
    </span>
  );
};

const Toast = ({ message, onClose }) => {
  useEffect(() => {
    const timer = setTimeout(onClose, 3000);
    return () => clearTimeout(timer);
  }, [onClose]);

  return (
    <div className="fixed bottom-6 right-6 bg-slate-800 text-white px-6 py-4 rounded-xl shadow-2xl flex items-center gap-4 animate-bounce-in z-50 border border-slate-700">
      <div className="bg-emerald-500 rounded-full p-1">
        <CheckCircle2 className="text-white" size={16} />
      </div>
      <span className="font-medium">{message}</span>
    </div>
  );
};

const renderPlatformIcon = (pid, size=14) => {
  const map = {
    telegram: { Icon: MessageCircle, color: 'text-blue-500', bg: 'bg-blue-50' },
    instagram: { Icon: Instagram, color: 'text-pink-600', bg: 'bg-pink-50' },
    website: { Icon: Globe, color: 'text-blue-500', bg: 'bg-blue-50' },
    vk: { Icon: Layout, color: 'text-blue-600', bg: 'bg-blue-50' },
    linkedin: { Icon: Linkedin, color: 'text-blue-700', bg: 'bg-blue-50' },
    tiktok: { Icon: Music, color: 'text-slate-700', bg: 'bg-slate-100' }, 
    youtube: { Icon: Youtube, color: 'text-red-600', bg: 'bg-red-50' }, 
    blog: { Icon: FileText, color: 'text-orange-600', bg: 'bg-orange-50' } 
  };
  const { Icon, color, bg } = map[pid] || { Icon: Zap, color: 'text-slate-400', bg: 'bg-slate-50' };
  return (
    <div className={`flex items-center justify-center rounded-lg ${bg} w-[${size+8}px] h-[${size+8}px] p-1.5`}>
      <Icon size={size} className={color} />
    </div>
  );
};

// --- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ---

export default function App() {
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const [user, setUser] = useState(null);
  
  // –ö–ª—é—á–∏ –¥–æ—Å—Ç—É–ø–∞
  const [validKeys, setValidKeys] = useState([
    'ADMIN-KEY-001', 
    'SECRET-2024', 
    'VIP-USER', 
    'GLAVRED-START'
  ]);

  // –ù–∞–≤–∏–≥–∞—Ü–∏—è
  const [activeTab, setActiveTab] = useState('projects'); 
  const [activeView, setActiveView] = useState('calendar'); 
  const [projectSubTab, setProjectSubTab] = useState('plan'); 
  const [planViewMode, setPlanViewMode] = useState('list'); 
  
  const [toast, setToast] = useState(null);

  // –î–∞–Ω–Ω—ã–µ
  const [isGenerating, setIsGenerating] = useState(false);
  const [generatingId, setGeneratingId] = useState(null); 
  const [generatedIdeas, setGeneratedIdeas] = useState([]); 
  
  const [showProjectModal, setShowProjectModal] = useState(false);

  // –°–æ—Å—Ç–æ—è–Ω–∏—è —Ñ–æ—Ä–º 
  const [authMode, setAuthMode] = useState('login');
  const [authForm, setAuthForm] = useState({ name: '', email: '', password: '', key: '' });
  const [profileName, setProfileName] = useState('');
  
  // –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ù–´–ï –ü–û–õ–Ø –ü–†–û–ï–ö–¢–ê
  const [newProjectData, setNewProjectData] = useState({ 
    name: '', 
    description: '', 
    targetAudience: '',
    tone: 'friendly',
    platforms: [] 
  });

  const [projects, setProjects] = useState([
    { 
      id: 1, 
      name: '–ö–æ—Ñ–µ–π–Ω—è "–ë–æ–¥—Ä–æ–µ —É—Ç—Ä–æ"', 
      description: '–ö—Ä–∞—Ñ—Ç–æ–≤—ã–π –∫–æ—Ñ–µ –∏ –¥–µ—Å–µ—Ä—Ç—ã.',
      targetAudience: '–°—Ç—É–¥–µ–Ω—Ç—ã, —Ñ—Ä–∏–ª–∞–Ω—Å–µ—Ä—ã',
      tone: 'friendly', 
      platforms: ['telegram', 'instagram'] 
    }
  ]);
  const [activeProjectId, setActiveProjectId] = useState(1);
  const activeProject = projects.find(p => p.id === activeProjectId) || projects[0] || {};

  const [posts, setPosts] = useState([
    { id: 1, projectId: 1, title: '–ê–Ω–æ–Ω—Å –æ—Å–µ–Ω–Ω–µ–≥–æ –º–µ–Ω—é', content: '–¢–µ–∫—Å—Ç –ø—Ä–æ –º–µ–Ω—é...', date: '2023-10-24', status: 'published', platform: 'instagram' },
    { id: 2, projectId: 1, title: '–ò—Å—Ç–æ—Ä–∏—è –Ω–∞—à–µ–≥–æ –±–∞—Ä–∏—Å—Ç–∞', content: '–ó–Ω–∞–∫–æ–º—å—Ç–µ—Å—å, —ç—Ç–æ –ê–ª–µ–∫—Å...', date: '2023-10-25', status: 'scheduled', platform: 'telegram' },
    { id: 3, projectId: 1, title: '–ö–∞–∫ –≤—ã–±—Ä–∞—Ç—å –∑–µ—Ä–Ω–æ –¥–æ–º–æ–π?', content: '–°–æ–≤–µ—Ç—ã –ø–æ –≤—ã–±–æ—Ä—É...', date: '2023-10-27', status: 'draft', platform: 'website' },
  ]);

  const [selectedPost, setSelectedPost] = useState(null);
  const currentProjectPosts = posts.filter(p => p.projectId === activeProjectId);

  // --- –õ–æ–≥–∏–∫–∞ ---

  const handleLogin = (e) => {
    e.preventDefault();
    if (authForm.email && authForm.password) {
      const userData = { name: 'Admin User', email: authForm.email, emailVerified: false };
      setUser(userData);
      setProfileName(userData.name);
      setIsAuthenticated(true);
      showToast('–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º!');
    }
  };

  const handleRegister = (e) => {
    e.preventDefault();
    if (!validKeys.includes(authForm.key)) {
      showToast('–ù–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞!');
      return;
    }
    const userData = { name: authForm.name, email: authForm.email, emailVerified: false };
    setUser(userData);
    setProfileName(userData.name);
    setValidKeys(prev => prev.filter(k => k !== authForm.key)); 
    setIsAuthenticated(true);
    showToast('–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω!');
  };

  const handleLogout = () => {
    if (window.confirm('–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞?')) {
      setIsAuthenticated(false);
      setUser(null);
      setAuthForm({ name: '', email: '', password: '', key: '' }); 
    }
  };

  const showToast = (msg) => {
    setToast(msg);
    setTimeout(() => setToast(null), 3000);
  };

  const handleSaveNewProject = () => {
    if (!newProjectData.name) return alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞');
    
    // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–µ–∫—Ç —Å–æ –í–°–ï–ú–ò –ø–æ–ª—è–º–∏
    const newProject = {
      id: Date.now(),
      name: newProjectData.name,
      description: newProjectData.description,
      targetAudience: newProjectData.targetAudience, // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¶–ê
      tone: newProjectData.tone, // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¢–æ–Ω
      platforms: newProjectData.platforms.length ? newProjectData.platforms : ['telegram']
    };
    
    setProjects([...projects, newProject]);
    setActiveProjectId(newProject.id);
    setShowProjectModal(false);
    setActiveTab('project_view');
    setProjectSubTab('ideas');
    showToast(`–ü—Ä–æ–µ–∫—Ç "${newProject.name}" —Å–æ–∑–¥–∞–Ω!`);
  };

  const handleDeleteProject = () => {
    if (window.confirm(`–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç "${activeProject.name}"?`)) {
      const updated = projects.filter(p => p.id !== activeProject.id);
      setProjects(updated);
      setPosts(prev => prev.filter(p => p.projectId !== activeProject.id));
      if (updated.length > 0) setActiveProjectId(updated[0].id); else setActiveProjectId(null);
      setActiveTab('projects');
      showToast('–ü—Ä–æ–µ–∫—Ç —É–¥–∞–ª–µ–Ω');
    }
  };

  const handleCreatePost = (overrides = {}) => {
    const newPost = { id: Date.now(), projectId: activeProjectId, title: '–ù–æ–≤—ã–π —á–µ—Ä–Ω–æ–≤–∏–∫', content: '', date: new Date().toISOString().split('T')[0], status: 'draft', platform: 'telegram', media: null, ...overrides };
    setPosts([...posts, newPost]);
    setSelectedPost(newPost);
    setActiveTab('editor');
    showToast('–ß–µ—Ä–Ω–æ–≤–∏–∫ —Å–æ–∑–¥–∞–Ω');
  };

  const handleGeneratePostFromIdea = (idea) => {
    setGeneratingId(idea.id); 
    setTimeout(() => {
      const generatedContent = `# ${idea.title}\n\n–ü—Ä–∏–≤–µ—Ç, –¥—Ä—É–∑—å—è! üëã\n\n${idea.desc}\n\n#${activeProject.name.replace(/\s/g, '')}`.trim();
      const newPost = {
        id: Date.now(),
        projectId: activeProjectId,
        title: idea.title,
        content: generatedContent,
        date: new Date().toISOString().split('T')[0],
        status: 'draft',
        platform: activeProject.platforms && activeProject.platforms[0] ? activeProject.platforms[0] : 'telegram',
        media: null
      };
      setPosts([...posts, newPost]);
      setSelectedPost(newPost);
      setGeneratingId(null);
      setActiveTab('editor');
      showToast('–ü–æ—Å—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω!');
    }, 2000);
  };

  const handleGenerateGlobalIdeas = () => {
    setIsGenerating(true);
    setTimeout(() => {
      setGeneratedIdeas([
        { id: 201, title: '–¢—Ä–µ–Ω–¥—ã SMM 2024', desc: '–û–±—â–∏–π –æ–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤.' },
        { id: 202, title: '–ö–∞–∫ –ø–æ–≤—ã—Å–∏—Ç—å –æ—Ö–≤–∞—Ç—ã?', desc: '–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ —Å–æ–≤–µ—Ç—ã –¥–ª—è –ª—é–±–æ–π –Ω–∏—à–∏.' },
        { id: 203, title: '–í–∏–∑—É–∞–ª—å–Ω—ã–π —à—É–º', desc: '–ü–æ—á–µ–º—É –º–∏–Ω–∏–º–∞–ª–∏–∑–º —Å–Ω–æ–≤–∞ –≤ –º–æ–¥–µ.' },
      ]);
      setIsGenerating(false);
      showToast('–ò–¥–µ–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã!');
    }, 1500);
  };

  const handleSavePost = () => {
    if (!selectedPost) return;
    setPosts(prev => prev.map(p => p.id === selectedPost.id ? selectedPost : p));
    showToast('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
  };

  const handleDeletePost = () => {
    if (!selectedPost) return;
    if (window.confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç?')) {
      setPosts(prev => prev.filter(p => p.id !== selectedPost.id));
      setSelectedPost(null);
      setActiveTab('project_view'); 
      showToast('–ü–æ—Å—Ç —É–¥–∞–ª–µ–Ω');
    }
  };

  const handleAiRewrite = () => {
    showToast('AI –ø–µ—Ä–µ–ø–∏—Å–∞–ª —Ç–µ–∫—Å—Ç (—Å–∏–º—É–ª—è—Ü–∏—è)');
    setSelectedPost(prev => ({...prev, content: prev.content + '\n\n‚ú® (–£–ª—É—á—à–µ–Ω–æ AI)'}));
  };

  const handleExportPdf = () => {
    showToast('–≠–∫—Å–ø–æ—Ä—Ç –≤ PDF –Ω–∞—á–∞–ª—Å—è...');
  };

  // --- RENDER FUNCTIONS (–≠–ö–†–ê–ù–´) ---

  const renderAuthScreen = () => (
    <div className="min-h-screen bg-slate-50 flex items-center justify-center p-4 font-sans text-slate-900">
      <Card className="w-full max-w-md p-10 shadow-xl border-slate-200">
        <div className="text-center mb-8">
          <div className="w-20 h-20 bg-blue-600 rounded-3xl mx-auto flex items-center justify-center mb-6 shadow-xl shadow-blue-200">
            <Feather className="text-white" size={40} />
          </div>
          <h1 className="text-3xl font-extrabold text-slate-900 tracking-tight">–ì–ª–∞–≤—Ä–µ–¥ AI</h1>
          <p className="text-slate-500 mt-3 font-medium">–ó–∞–∫—Ä—ã—Ç—ã–π –∫–ª—É–± –¥–ª—è –ø—Ä–æ—Ñ–∏</p>
        </div>

        <div className="flex p-1 bg-slate-100 rounded-xl mb-6">
          <button 
            className={`flex-1 py-2 text-sm font-semibold rounded-lg transition-all ${authMode === 'login' ? 'bg-white shadow-sm text-slate-900' : 'text-slate-500 hover:text-slate-700'}`}
            onClick={() => setAuthMode('login')}
          >
            –í—Ö–æ–¥
          </button>
          <button 
            className={`flex-1 py-2 text-sm font-semibold rounded-lg transition-all ${authMode === 'register' ? 'bg-white shadow-sm text-slate-900' : 'text-slate-500 hover:text-slate-700'}`}
            onClick={() => setAuthMode('register')}
          >
            –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
          </button>
        </div>

        <form onSubmit={authMode === 'login' ? handleLogin : handleRegister} className="space-y-5">
          {authMode === 'register' && (
            <div>
              <label className="block text-sm font-semibold text-slate-700 mb-2">–ò–º—è</label>
              <input 
                type="text" 
                placeholder="–í–∞—à–µ –∏–º—è" 
                className="w-full p-3.5 bg-white border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all shadow-sm"
                value={authForm.name}
                onChange={e => setAuthForm({...authForm, name: e.target.value})}
                required 
              />
            </div>
          )}
          
          <div>
            <label className="block text-sm font-semibold text-slate-700 mb-2">Email</label>
            <input 
              type="email" 
              placeholder="hello@example.com" 
              className="w-full p-3.5 bg-white border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all shadow-sm"
              value={authForm.email}
              onChange={e => setAuthForm({...authForm, email: e.target.value})}
              required 
            />
          </div>
          
          <div>
            <label className="block text-sm font-semibold text-slate-700 mb-2">–ü–∞—Ä–æ–ª—å</label>
            <input 
              type="password" 
              placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
              className="w-full p-3.5 bg-white border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all shadow-sm"
              value={authForm.password}
              onChange={e => setAuthForm({...authForm, password: e.target.value})}
              required 
            />
          </div>

          {authMode === 'register' && (
            <div>
              <label className="block text-sm font-bold text-blue-600 mb-2 flex items-center gap-2">
                <Key size={16}/> –ö–ª—é—á –¥–æ—Å—Ç—É–ø–∞
              </label>
              <input 
                type="text" 
                placeholder="ADMIN-KEY-XXXX" 
                className="w-full p-3.5 bg-blue-50 border border-blue-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none font-mono text-blue-900 placeholder-blue-300"
                value={authForm.key}
                onChange={e => setAuthForm({...authForm, key: e.target.value})}
                required 
              />
              <p className="text-xs text-slate-400 mt-2">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤–æ–∑–º–æ–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –ø–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—é.</p>
            </div>
          )}

          <Button type="submit" className="w-full py-3.5 text-lg shadow-xl shadow-blue-200/50">
            {authMode === 'login' ? '–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É' : '–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç'}
          </Button>
        </form>
      </Card>
    </div>
  );

  const CreateProjectModal = () => (
    <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div className="bg-white rounded-3xl shadow-2xl w-full max-w-lg overflow-hidden animate-in fade-in zoom-in duration-200 max-h-[90vh] overflow-y-auto">
        <div className="p-6 border-b border-slate-100 flex justify-between items-center sticky top-0 bg-white z-10">
          <h3 className="text-xl font-bold text-slate-800">–ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</h3>
          <button onClick={() => setShowProjectModal(false)}><X className="text-slate-400 hover:text-slate-600" /></button>
        </div>
        <div className="p-6 space-y-6">
          {/* –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ */}
          <div>
            <label className="block text-sm font-semibold text-slate-700 mb-2">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞</label>
            <input 
              placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–æ–π –ë—Ä–µ–Ω–¥" 
              className="w-full p-3.5 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all font-medium bg-white"
              value={newProjectData.name}
              onChange={e => setNewProjectData({...newProjectData, name: e.target.value})}
            />
          </div>

          {/* –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ */}
          <div>
            <label className="block text-sm font-semibold text-slate-700 mb-2">–û–ø–∏—Å–∞–Ω–∏–µ</label>
            <textarea 
              placeholder="–û–ø–∏—à–∏—Ç–µ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —Ü–µ–ª–∏..." 
              className="w-full p-3.5 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all h-28 resize-none bg-white"
              value={newProjectData.description}
              onChange={e => setNewProjectData({...newProjectData, description: e.target.value})}
            />
          </div>

          {/* –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è - –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–û */}
          <div>
            <label className="block text-sm font-semibold text-slate-700 mb-2">–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è</label>
            <input 
              placeholder="–ö—Ç–æ –≤–∞—à–∏ –∫–ª–∏–µ–Ω—Ç—ã?" 
              className="w-full p-3.5 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all bg-white"
              value={newProjectData.targetAudience}
              onChange={e => setNewProjectData({...newProjectData, targetAudience: e.target.value})}
            />
          </div>

          {/* –í—ã–±–æ—Ä –ø–ª–∞—Ç—Ñ–æ—Ä–º - –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–û */}
          <div>
             <label className="block text-sm font-semibold text-slate-700 mb-3">–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã</label>
             <div className="flex flex-wrap gap-2">
                {[
                  { id: 'instagram', label: 'Instagram', icon: Instagram, color: 'text-pink-600' },
                  { id: 'tiktok', label: 'TikTok', icon: Music, color: 'text-black' },
                  { id: 'telegram', label: 'Telegram', icon: MessageCircle, color: 'text-blue-500' },
                  { id: 'youtube', label: 'YouTube', icon: Youtube, color: 'text-red-600' },
                  { id: 'blog', label: '–ë–ª–æ–≥', icon: FileText, color: 'text-orange-600' },
                  { id: 'linkedin', label: 'LinkedIn', icon: Linkedin, color: 'text-blue-700' },
                ].map(platform => {
                   const isSelected = newProjectData.platforms.includes(platform.id);
                   return (
                     <button
                        key={platform.id}
                        onClick={() => {
                          setNewProjectData(prev => ({
                            ...prev, 
                            platforms: isSelected
                              ? prev.platforms.filter(x => x !== platform.id) 
                              : [...prev.platforms, platform.id]
                          }))
                        }}
                        className={`px-4 py-2 rounded-xl text-sm font-medium transition-all flex items-center gap-2 border ${
                           isSelected
                              ? 'bg-blue-600 text-white border-blue-600 shadow-md'
                              : 'bg-white text-slate-600 border-slate-200 hover:border-slate-300 hover:bg-slate-50'
                        }`}
                     >
                        <platform.icon size={16} className={isSelected ? 'text-white' : platform.color} />
                        {platform.label}
                     </button>
                   )
                })}
             </div>
          </div>

          {/* –¢–æ–Ω –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ - –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–û */}
          <div>
            <label className="block text-sm font-semibold text-slate-700 mb-2">–¢–æ–Ω –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏</label>
            <select 
               className="w-full p-3.5 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all bg-white"
               value={newProjectData.tone}
               onChange={e => setNewProjectData({...newProjectData, tone: e.target.value})}
            >
              <option value="friendly">–î—Ä—É–∂–µ–ª—é–±–Ω—ã–π (Friendly)</option>
              <option value="professional">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π (Professional)</option>
              <option value="bold">–î–µ—Ä–∑–∫–∏–π (Bold)</option>
              <option value="formal">–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π (Formal)</option>
              <option value="humorous">–° —é–º–æ—Ä–æ–º (Humorous)</option>
            </select>
          </div>
        </div>
        <div className="p-6 bg-slate-50 flex justify-end gap-3 sticky bottom-0 border-t border-slate-100">
          <Button variant="secondary" onClick={() => setShowProjectModal(false)}>–û—Ç–º–µ–Ω–∞</Button>
          <Button onClick={handleSaveNewProject}>–°–æ–∑–¥–∞—Ç—å</Button>
        </div>
      </div>
    </div>
  );

  // --- –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ù–´–ï –ì–õ–û–ë–ê–õ–¨–ù–´–ï –≠–ö–†–ê–ù–´ ---

  const renderGlobalProjectsView = () => (
    <div className="h-full flex flex-col p-8 overflow-y-auto">
      <div className="flex justify-between items-center mb-8">
        <div>
          <h2 className="text-3xl font-bold text-slate-900 tracking-tight">–ú–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã</h2>
          <p className="text-slate-500 mt-2 text-lg">–£–ø—Ä–∞–≤–ª—è–π—Ç–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –±—Ä–µ–Ω–¥–æ–≤</p>
        </div>
      </div>
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {projects.map(p => (
           <Card key={p.id} onClick={() => { setActiveProjectId(p.id); setActiveTab('project_view'); setProjectSubTab('plan'); }} className="p-6 h-56 flex flex-col hover:border-blue-500 cursor-pointer">
              <div className="flex justify-between items-start mb-4">
                 <div className="w-12 h-12 bg-blue-50 rounded-xl flex items-center justify-center text-blue-600 font-bold text-lg">{p.name[0]}</div>
                 <div className="flex -space-x-2">
                    {p.platforms.slice(0,3).map(pid => <div key={pid} className="w-8 h-8 rounded-full border border-slate-100 bg-white flex items-center justify-center">{renderPlatformIcon(pid, 14)}</div>)}
                 </div>
              </div>
              <h3 className="font-bold text-lg text-slate-900 mb-2">{p.name}</h3>
              <p className="text-sm text-slate-500 flex-1 line-clamp-2">{p.description}</p>
              <div className="text-xs text-slate-400 flex items-center gap-2 mt-4 font-medium"><Folder size={14}/> {posts.filter(x=>x.projectId===p.id).length} –ø–æ—Å—Ç–æ–≤</div>
           </Card>
        ))}
        <button 
          onClick={() => {
            setNewProjectData({ name: '', description: '', targetAudience: '', tone: 'friendly', platforms: [] });
            setShowProjectModal(true);
          }}
          className="p-6 rounded-2xl border-2 border-dashed border-slate-300 flex flex-col items-center justify-center text-slate-400 hover:border-blue-500 hover:text-blue-600 transition-all h-56 group"
        >
           <div className="w-12 h-12 rounded-full bg-slate-100 group-hover:bg-blue-50 flex items-center justify-center mb-3 text-slate-400 group-hover:text-blue-600 transition-colors"><Plus size={24}/></div>
           <span className="font-bold text-lg">–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç</span>
        </button>
      </div>
    </div>
  );

  const renderGlobalCalendarView = () => {
    const days = Array.from({ length: 35 }, (_, i) => {
      const day = i - 2;
      const dateStr = day > 0 && day <= 31 ? `2023-10-${day.toString().padStart(2, '0')}` : null;
      return { dayNum: day > 0 && day <= 31 ? day : null, date: dateStr, posts: dateStr ? posts.filter(p => p.date === dateStr) : [] };
    });

    return (
      <div className="h-full flex flex-col">
        <div className="flex justify-between items-center px-8 py-6 border-b border-slate-200 bg-white">
           <h2 className="text-2xl font-bold text-slate-900 tracking-tight">–û–±—â–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å</h2>
           <div className="flex bg-slate-100 p-1.5 rounded-xl">
              <button onClick={() => setActiveView('calendar')} className={`px-4 py-1.5 rounded-lg text-sm font-semibold transition-all ${activeView === 'calendar' ? 'bg-white shadow-sm text-slate-900' : 'text-slate-500 hover:text-slate-700'}`}>–ö–∞–ª–µ–Ω–¥–∞—Ä—å</button>
              <button onClick={() => setActiveView('kanban')} className={`px-4 py-1.5 rounded-lg text-sm font-semibold transition-all ${activeView === 'kanban' ? 'bg-white shadow-sm text-slate-900' : 'text-slate-500 hover:text-slate-700'}`}>–ö–∞–Ω–±–∞–Ω</button>
           </div>
        </div>
        
        {activeView === 'calendar' ? (
          <div className="grid grid-cols-7 gap-px bg-slate-200 border-b border-slate-200 overflow-hidden flex-1">
            {['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'].map(d => (
              <div key={d} className="bg-slate-50 p-3 text-xs font-bold text-slate-400 text-center uppercase tracking-wider">{d}</div>
            ))}
            {days.map((day, idx) => (
              <div key={idx} className={`bg-white p-2 min-h-[120px] transition-colors group relative border-b border-r border-slate-100 ${!day.dayNum ? 'bg-slate-50/30' : 'hover:bg-slate-50'}`}>
                {day.dayNum && (
                  <>
                    <span className={`text-sm font-bold ml-1 ${day.dayNum === 24 ? 'text-white bg-blue-600 w-7 h-7 flex items-center justify-center rounded-full shadow-lg shadow-blue-200' : 'text-slate-700'}`}>
                      {day.dayNum}
                    </span>
                    <button onClick={(e) => { e.stopPropagation(); handleCreatePost({ date: day.date }); }} className="opacity-0 group-hover:opacity-100 absolute top-2 right-2 text-slate-400 hover:text-blue-600 p-1.5 hover:bg-blue-50 rounded-lg transition-all"><Plus size={18} /></button>
                    <div className="mt-2 space-y-1.5">
                      {day.posts.map(post => (
                        <div key={post.id} onClick={() => { setSelectedPost(post); setActiveProjectId(post.projectId); setActiveTab('editor'); }} className="text-xs p-2 rounded-lg bg-white border border-slate-200 text-slate-800 cursor-pointer hover:border-blue-300 hover:shadow-sm transition-all flex items-center gap-2 shadow-sm">
                          {renderPlatformIcon(post.platform, 14)}
                          <span className="truncate font-medium">{post.title}</span>
                        </div>
                      ))}
                    </div>
                  </>
                )}
              </div>
            ))}
          </div>
        ) : (
          <div className="flex gap-6 h-full overflow-x-auto p-8 bg-slate-50">
            {['idea', 'draft', 'scheduled', 'published'].map(status => (
              <div key={status} className="w-80 flex-shrink-0 flex flex-col bg-slate-100/50 rounded-2xl p-4 border border-slate-200/60">
                <div className="flex justify-between items-center mb-4 px-1">
                  <h3 className="font-bold text-slate-700 capitalize">{status}</h3>
                  <span className="bg-white text-slate-600 text-xs font-bold px-2.5 py-1 rounded-md border border-slate-200 shadow-sm">{posts.filter(p => p.status === status).length}</span>
                </div>
                <div className="space-y-3 overflow-y-auto flex-1 pr-1 custom-scrollbar">
                  {posts.filter(p => p.status === status).map(post => (
                    <Card key={post.id} onClick={() => { setSelectedPost(post); setActiveProjectId(post.projectId); setActiveTab('editor'); }} className="p-4 bg-white shadow-sm hover:shadow-md border-slate-200 cursor-grab active:cursor-grabbing">
                      <div className="flex justify-between items-start mb-3">
                        <div className="flex gap-1">{renderPlatformIcon(post.platform)}</div>
                      </div>
                      <h4 className="text-sm font-bold text-slate-800 mb-2 leading-tight">{post.title}</h4>
                      <div className="flex items-center text-xs text-slate-400 font-medium">
                        <Folder size={12} className="mr-1.5"/> 
                        {projects.find(pr => pr.id === post.projectId)?.name}
                      </div>
                    </Card>
                  ))}
                </div>
              </div>
            ))}
          </div>
        )}
      </div>
    );
  };

  const renderGlobalIdeasView = () => (
    <div className="h-full flex flex-col p-8 overflow-y-auto">
       <div className="flex justify-between items-center mb-8">
         <div>
            <h2 className="text-3xl font-bold text-slate-900 tracking-tight">–ë–∞–Ω–∫ –∏–¥–µ–π AI</h2>
            <p className="text-slate-500 mt-2 text-lg">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–±—â–∏—Ö —Ç—Ä–µ–Ω–¥–æ–≤</p>
         </div>
         <Button onClick={handleGenerateGlobalIdeas} icon={Zap} disabled={isGenerating} className="shadow-xl shadow-indigo-200">
            {isGenerating ? '–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º...' : '–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ'}
         </Button>
       </div>

       {generatedIdeas.length === 0 && !isGenerating ? (
          <div className="flex-1 flex flex-col items-center justify-center text-center opacity-50">
             <div className="bg-slate-100 p-6 rounded-full mb-6">
                <Sparkles size={48} className="text-slate-400" />
             </div>
             <p className="text-xl font-medium text-slate-600">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∏–¥–µ–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</p>
          </div>
       ) : (
         <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {generatedIdeas.map(idea => (
               <Card key={idea.id} className="p-6 flex flex-col hover:border-blue-400 group border-l-4 border-l-blue-500">
                  <div className="flex justify-between items-start mb-4">
                     <span className="bg-blue-50 text-blue-700 text-xs px-2.5 py-1 rounded-lg font-bold uppercase tracking-wider">Trend</span>
                     <Sparkles size={18} className="text-blue-300" />
                  </div>
                  <h3 className="font-bold text-lg text-slate-900 mb-3 leading-tight">{idea.title}</h3>
                  <p className="text-sm text-slate-500 mb-6 flex-1 leading-relaxed">{idea.desc}</p>
                  <Button variant="secondary" className="w-full mt-auto" onClick={() => handleCreatePost({ title: idea.title, content: idea.desc, status: 'idea' })}>
                    –í —á–µ—Ä–Ω–æ–≤–∏–∫–∏
                  </Button>
               </Card>
            ))}
         </div>
       )}
    </div>
  );

  const renderProjectView = () => {
    const ideas = [
      { id: 101, title: '–ú–∏—Ñ—ã –Ω–∞—à–µ–π –Ω–∏—à–∏', desc: '–†–∞–∑–≤–µ–Ω—á–∏–≤–∞–µ–º –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–±–ª—É–∂–¥–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤.' },
      { id: 102, title: '–ö–µ–π—Å: –ö–∞–∫ –º—ã —Ä–µ—à–∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—É', desc: '–ò—Å—Ç–æ—Ä–∏—è —É—Å–ø–µ—Ö–∞ –æ–¥–Ω–æ–≥–æ –∏–∑ –∫–ª–∏–µ–Ω—Ç–æ–≤.' },
      { id: 103, title: '–¢—Ä–µ–Ω–¥—ã 2024 –≥–æ–¥–∞', desc: '–ß—Ç–æ –±—É–¥–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.' },
      { id: 104, title: '–ë—ç–∫—Å—Ç–µ–π–¥–∂', desc: '–ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –∫—É—Ö–Ω—é –ø—Ä–æ–µ–∫—Ç–∞.' },
    ];

    const groupedPosts = [...currentProjectPosts].sort((a,b)=>new Date(a.date)-new Date(b.date)).reduce((g, p) => {
      const d = p.date || '–ë–µ–∑ –¥–∞—Ç—ã'; if(!g[d]) g[d]=[]; g[d].push(p); return g;
    }, {});

    const formatDate = (dateStr) => {
      if (dateStr === '–ë–µ–∑ –¥–∞—Ç—ã') return dateStr;
      const options = { weekday: 'long', day: 'numeric', month: 'long' };
      return new Date(dateStr).toLocaleDateString('ru-RU', options);
    };

    return (
      <div className="h-full flex flex-col">
        <div className="bg-white border-b border-slate-200 px-8 py-6">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <button onClick={() => setActiveTab('projects')} className="p-2.5 hover:bg-slate-100 rounded-xl text-slate-400 hover:text-slate-700 transition-colors">
                <ChevronLeft size={20} />
              </button>
              <div>
                <h1 className="text-2xl font-bold text-slate-900 tracking-tight">{activeProject.name}</h1>
                <div className="flex items-center gap-2 mt-2">
                  {activeProject.platforms?.map(p => (
                    <span key={p} className="text-xs font-bold text-slate-500 bg-slate-100 px-2.5 py-1 rounded-lg uppercase tracking-wide border border-slate-200">{p}</span>
                  ))}
                </div>
              </div>
            </div>
            <Button variant="secondary" icon={Settings}>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</Button>
          </div>
          
          <div className="flex gap-8 mt-10 border-b border-slate-100 -mb-6">
            {[
              { id: 'plan', label: '–ö–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω', icon: CalendarIcon },
              { id: 'ideas', label: '–ë–∞–Ω–∫ –∏–¥–µ–π AI', icon: Sparkles },
              { id: 'settings', label: '–ü–∞—Ä–∞–º–µ—Ç—Ä—ã', icon: Settings }
            ].map(tab => (
              <button
                key={tab.id}
                onClick={() => setProjectSubTab(tab.id)}
                className={`pb-4 px-1 flex items-center gap-2 font-semibold text-sm transition-all relative ${
                  projectSubTab === tab.id ? 'text-blue-600' : 'text-slate-500 hover:text-slate-800'
                }`}
              >
                <tab.icon size={18} />
                {tab.label}
                {projectSubTab === tab.id && (
                  <div className="absolute bottom-0 left-0 w-full h-0.5 bg-blue-600 rounded-t-full shadow-[0_-2px_10px_rgba(37,99,235,0.5)]"></div>
                )}
              </button>
            ))}
          </div>
        </div>

        <div className="flex-1 bg-slate-50 p-8 overflow-y-auto">
          {projectSubTab === 'ideas' && (
            <div className="max-w-6xl mx-auto">
              <div className="flex justify-between items-center mb-8">
                <div>
                  <h2 className="text-2xl font-bold text-slate-900">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h2>
                  <p className="text-slate-500 mt-1">–ò–ò –ø–æ–¥–æ–±—Ä–∞–ª —Ç–µ–º—ã –¥–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞</p>
                </div>
                <Button icon={RefreshCw} variant="ghost">–û–±–Ω–æ–≤–∏—Ç—å</Button>
              </div>
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {ideas.map(idea => (
                  <Card key={idea.id} className="p-6 flex flex-col hover:border-blue-300 transition-all border-l-4 border-l-blue-500">
                    <span className="bg-blue-50 text-blue-700 text-xs font-bold px-2.5 py-1 rounded-lg uppercase tracking-wide">AI Suggestion</span>
                    <h3 className="text-lg font-bold text-slate-900 mb-2 leading-tight">{idea.title}</h3>
                    <p className="text-sm text-slate-500 mb-6 flex-1 leading-relaxed">{idea.desc}</p>
                    <Button 
                      onClick={() => handleGeneratePostFromIdea(idea)} 
                      disabled={generatingId === idea.id}
                      icon={generatingId === idea.id ? RefreshCw : Wand2}
                      className="w-full"
                    >
                      {generatingId === idea.id ? '–ü–∏—à–µ–º —Ç–µ–∫—Å—Ç...' : '–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç'}
                    </Button>
                  </Card>
                ))}
              </div>
            </div>
          )}

          {projectSubTab === 'plan' && (
            <div className="h-full flex flex-col">
               <div className="flex justify-between items-center mb-8">
                  <div>
                    <h2 className="text-2xl font-bold text-slate-900">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h2>
                    <p className="text-slate-500 mt-1">–í–∞—à –ø–ª–∞–Ω –≤—ã—Ö–æ–¥–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</p>
                  </div>
                  <div className="flex bg-white p-1.5 rounded-xl border border-slate-200 shadow-sm">
                     <button onClick={() => setPlanViewMode('list')} className={`px-4 py-2 rounded-lg text-sm font-semibold transition-all flex items-center gap-2 ${planViewMode === 'list' ? 'bg-slate-100 text-slate-900' : 'text-slate-500 hover:text-slate-700'}`}><List size={18}/> –°–ø–∏—Å–æ–∫</button>
                     <button onClick={() => setPlanViewMode('calendar')} className={`px-4 py-2 rounded-lg text-sm font-semibold transition-all flex items-center gap-2 ${planViewMode === 'calendar' ? 'bg-slate-100 text-slate-900' : 'text-slate-500 hover:text-slate-700'}`}><Grid size={18}/> –ö–∞–ª–µ–Ω–¥–∞—Ä—å</button>
                  </div>
               </div>

               {planViewMode === 'list' ? (
                 <div className="space-y-10 max-w-4xl mx-auto w-full pb-10">
                    {Object.keys(groupedPosts).length === 0 ? (
                      <div className="text-center py-20 text-slate-400">–ù–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π —á–µ—Ä–Ω–æ–≤–∏–∫!</div>
                    ) : (
                      Object.keys(groupedPosts).map(date => (
                        <div key={date}>
                           <h3 className="text-sm font-bold text-slate-400 uppercase tracking-wider mb-4 border-b border-slate-200 pb-2 sticky top-0 bg-slate-50 z-10 backdrop-blur-sm">{formatDate(date)}</h3>
                           <div className="space-y-4">
                             {groupedPosts[date].map(post => (
                               <Card key={post.id} onClick={() => { setSelectedPost(post); setActiveTab('editor'); }} className="p-5 flex items-center gap-5 hover:border-blue-300 transition-all cursor-pointer group">
                                  <div className="w-12 h-12 rounded-xl bg-slate-50 flex items-center justify-center flex-shrink-0 border border-slate-100 shadow-sm group-hover:scale-105 transition-transform">{renderPlatformIcon(post.platform, 24)}</div>
                                  <div className="flex-1 min-w-0">
                                     <h4 className="font-bold text-lg text-slate-900 truncate group-hover:text-blue-600 transition-colors">{post.title}</h4>
                                     <p className="text-sm text-slate-500 truncate mt-0.5">{post.content.substring(0, 80)}...</p>
                                  </div>
                                  <div className="flex items-center gap-4">
                                     <StatusBadge status={post.status} />
                                     <Button variant="ghost" className="opacity-0 group-hover:opacity-100 transition-opacity translate-x-2 group-hover:translate-x-0" size="sm" icon={PenTool}>–†–µ–¥.</Button>
                                  </div>
                               </Card>
                             ))}
                           </div>
                        </div>
                      ))
                    )}
                 </div>
               ) : (
                 <div className="bg-white rounded-2xl border border-slate-200 p-6 shadow-sm flex-1">
                    <div className="grid grid-cols-7 gap-px bg-slate-100 rounded-xl overflow-hidden h-full">
                      {Array.from({length: 35}).map((_, i) => {
                        const day = i - 2;
                        const dateStr = day > 0 && day <= 31 ? `2023-10-${day.toString().padStart(2,'0')}` : null;
                        const dayPosts = currentProjectPosts.filter(p => p.date === dateStr);
                        
                        return (
                          <div key={i} className={`bg-white p-2 min-h-[120px] ${!day ? 'bg-slate-50/50' : 'hover:bg-slate-50 transition-colors'} relative group`}>
                            {day > 0 && day <= 31 && (
                              <>
                                <div className="flex justify-between items-center mb-2">
                                  <span className="text-sm font-bold text-slate-700 ml-1">{day}</span>
                                  <button onClick={(e) => { e.stopPropagation(); handleCreatePost({ date: dateStr }); }} className="text-slate-300 hover:text-blue-600 opacity-0 hover:opacity-100 p-1 transition-all"><Plus size={16}/></button>
                                </div>
                                <div className="space-y-1.5">
                                  {dayPosts.map(post => (
                                    <div key={post.id} onClick={() => { setSelectedPost(post); setActiveTab('editor'); }} className="text-xs p-2 rounded-lg bg-white border border-slate-200 shadow-sm hover:shadow hover:border-blue-300 cursor-pointer truncate font-medium text-slate-700 transition-all flex items-center gap-1.5">
                                      {renderPlatformIcon(post.platform, 12)}
                                      <span className="truncate">{post.title}</span>
                                    </div>
                                  ))}
                                </div>
                              </>
                            )}
                          </div>
                        )
                      })}
                    </div>
                 </div>
               )}
            </div>
          )}
        </div>
      </div>
    );
  };

  const renderEditorView = () => {
    if (!selectedPost) return <div className="p-8">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Å—Ç</div>;
    
    const [isMediaGenerating, setIsMediaGenerating] = useState(false);
    
    const generateMedia = (type) => {
      setIsMediaGenerating(true);
      setTimeout(() => {
        setIsMediaGenerating(false);
        const mediaContent = type === 'video' 
          ? { type: 'video', url: 'https://assets.mixkit.co/videos/preview/mixkit-tree-branches-in-the-breeze-1188-large.mp4' } 
          : { type: 'image', url: 'https://picsum.photos/800/400' };
        setSelectedPost(prev => ({ ...prev, media: mediaContent }));
        showToast(`${type === 'video' ? '–í–∏–¥–µ–æ' : '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ'} —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ!`);
      }, 3000);
    };

    return (
      <div className="h-full flex flex-col bg-white">
        <div className="border-b border-slate-200 px-8 py-5 flex justify-between items-center bg-white z-10">
          <div className="flex items-center gap-6">
            <button onClick={() => setActiveTab('project_view')} className="text-slate-400 hover:text-slate-800 flex items-center gap-2 font-bold text-sm transition-colors">
              <ChevronLeft size={20} /> –ù–∞–∑–∞–¥
            </button>
            <div className="h-8 w-px bg-slate-200"></div>
            <div className="flex items-center gap-3">
               <StatusBadge status={selectedPost.status} />
               <span className="text-slate-300">|</span>
               <div className="flex items-center gap-2 text-sm font-medium text-slate-600">
                 {renderPlatformIcon(selectedPost.platform)}
                 <span className="capitalize">{selectedPost.platform}</span>
               </div>
            </div>
          </div>
          <div className="flex gap-3">
            <Button variant="ghost" size="sm" onClick={handleAiRewrite}>
              <RefreshCw size={16} className="mr-2"/> AI –†–µ—Ä–∞–π—Ç
            </Button>
            <Button variant="ghost" size="sm" onClick={handleExportPdf}>
              <FileDown size={16} className="mr-2"/> –≠–∫—Å–ø–æ—Ä—Ç
            </Button>
            <div className="h-8 w-px bg-slate-200 mx-1"></div>
            <Button variant="danger" size="sm" icon={Trash2} onClick={handleDeletePost}>–£–¥–∞–ª–∏—Ç—å</Button>
            <Button variant="primary" size="sm" icon={Save} onClick={handleSavePost}>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</Button>
          </div>
        </div>
        
        <div className="flex-1 flex overflow-hidden">
          <div className="flex-1 p-10 overflow-y-auto max-w-5xl mx-auto w-full">
            <input 
              className="w-full text-4xl font-extrabold text-slate-900 placeholder-slate-300 outline-none mb-8 bg-transparent"
              value={selectedPost.title}
              onChange={e => setSelectedPost({...selectedPost, title: e.target.value})}
              placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ—Å—Ç–∞"
            />
            <textarea 
              className="w-full min-h-[400px] resize-none outline-none text-lg text-slate-600 leading-8 bg-transparent"
              placeholder="–ù–∞—á–Ω–∏—Ç–µ –ø–∏—Å–∞—Ç—å..."
              value={selectedPost.content}
              onChange={e => setSelectedPost({...selectedPost, content: e.target.value})}
            />
            
            {selectedPost.media && (
              <div className="mt-12 mb-8 animate-in fade-in slide-in-from-bottom-4 duration-500">
                <h4 className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                  <CheckCircle2 size={16} className="text-emerald-500"/>
                  –ú–µ–¥–∏–∞-–∫–æ–Ω—Ç–µ–Ω—Ç
                </h4>
                <div className="rounded-2xl overflow-hidden border border-slate-200 shadow-lg relative group max-w-3xl">
                  {selectedPost.media.type === 'video' ? (
                    <div className="aspect-video bg-black flex items-center justify-center relative">
                       <div className="absolute inset-0 flex items-center justify-center">
                          <PlayCircle className="text-white w-16 h-16"/>
                       </div>
                    </div>
                  ) : (
                    <img src={selectedPost.media.url} alt="Generated" className="w-full h-auto object-cover" />
                  )}
                  <div className="absolute top-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                     <button className="bg-white/90 backdrop-blur p-2.5 rounded-xl shadow-sm text-slate-700 hover:text-blue-600 transition-colors" title="–°–∫–∞—á–∞—Ç—å"><Download size={20}/></button>
                     <button className="bg-white/90 backdrop-blur p-2.5 rounded-xl shadow-sm text-slate-700 hover:text-red-600 transition-colors" onClick={() => setSelectedPost(prev => ({...prev, media: null}))}><Trash2 size={20}/></button>
                  </div>
                </div>
              </div>
            )}
          </div>
          
          <div className="w-96 border-l border-slate-200 bg-slate-50 p-8 hidden xl:block overflow-y-auto">
            <h4 className="font-bold text-slate-400 text-xs uppercase tracking-widest mb-6">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</h4>
            <div className="space-y-6">
              <div className="bg-white p-5 rounded-2xl border border-slate-200 shadow-sm">
                <label className="text-xs text-slate-500 font-bold block mb-2 uppercase tracking-wide">–î–∞—Ç–∞</label>
                <div className="flex items-center gap-3 text-slate-800 text-sm font-medium bg-slate-50 p-3 rounded-xl border border-slate-100">
                  <CalendarIcon size={18} className="text-slate-400" /> 
                  <input type="date" value={selectedPost.date || ''} onChange={e => setSelectedPost({...selectedPost, date: e.target.value})} className="bg-transparent outline-none w-full cursor-pointer"/>
                </div>
              </div>
              <div className="bg-white p-5 rounded-2xl border border-slate-200 shadow-sm">
                <label className="text-xs text-slate-500 font-bold block mb-2 uppercase tracking-wide">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</label>
                <div className="relative">
                  <select 
                     value={selectedPost.platform}
                     onChange={e => setSelectedPost({...selectedPost, platform: e.target.value})}
                     className="w-full text-sm bg-slate-50 p-3 rounded-xl border border-slate-100 outline-none appearance-none font-medium text-slate-800"
                  >
                     <option value="telegram">Telegram</option>
                     <option value="instagram">Instagram</option>
                     <option value="vk">VK</option>
                     <option value="youtube">YouTube</option>
                     <option value="tiktok">TikTok</option>
                  </select>
                  <ChevronRight className="absolute right-3 top-3.5 text-slate-400 rotate-90" size={16}/>
                </div>
              </div>
              
              <div className="bg-white p-5 rounded-2xl border border-slate-200 shadow-sm">
                 <label className="text-xs text-slate-500 font-bold block mb-4 uppercase tracking-wide flex items-center justify-between">
                   <span>AI –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä</span>
                 </label>
                 
                 <div className="grid grid-cols-2 gap-3">
                   <button 
                     onClick={() => generateMedia('image')}
                     disabled={isMediaGenerating || selectedPost.media}
                     className="flex flex-col items-center justify-center gap-2 p-4 rounded-xl border border-slate-100 bg-slate-50 hover:bg-blue-50 hover:border-blue-200 hover:text-blue-600 transition-all text-slate-600 disabled:opacity-50"
                   >
                     {isMediaGenerating ? <RefreshCw size={20} className="animate-spin"/> : <ImageIcon size={20}/>}
                     <span className="text-xs font-semibold">–û–±–ª–æ–∂–∫–∞</span>
                   </button>
                   <button 
                     onClick={() => generateMedia('video')}
                     disabled={isMediaGenerating || selectedPost.media}
                     className="flex flex-col items-center justify-center gap-2 p-4 rounded-xl border border-slate-100 bg-slate-50 hover:bg-blue-50 hover:border-blue-200 hover:text-blue-600 transition-all text-slate-600 disabled:opacity-50"
                   >
                     {isMediaGenerating ? <RefreshCw size={20} className="animate-spin"/> : <Video size={20}/>}
                     <span className="text-xs font-semibold">–í–∏–¥–µ–æ</span>
                   </button>
                 </div>
                 <button 
                   onClick={() => showToast('–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')}
                   className="w-full mt-3 py-3 border border-dashed border-slate-300 text-slate-400 rounded-xl text-xs font-medium hover:border-slate-400 hover:text-slate-600 transition-colors flex items-center justify-center gap-2"
                 >
                   <PieChart size={14}/> –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫—É
                 </button>
              </div>

              <div className="bg-gradient-to-br from-indigo-50 to-blue-50 p-5 rounded-2xl border border-indigo-100">
                 <h5 className="flex items-center gap-2 text-indigo-900 font-bold text-sm mb-3"><Sparkles size={16} className="text-indigo-600"/> AI –°–æ–≤–µ—Ç</h5>
                 <p className="text-xs text-indigo-800/80 leading-relaxed font-medium">–¢–µ–∫—Å—Ç —Ö–æ—Ä–æ—à–∏–π, –Ω–æ –¥–æ–±–∞–≤—å—Ç–µ –ø—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é (CTA) –≤ –∫–æ–Ω—Ü–µ, —á—Ç–æ–±—ã –ø–æ–≤—ã—Å–∏—Ç—å –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å –∞—É–¥–∏—Ç–æ—Ä–∏–∏.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    );
  };

  const renderProfileView = () => {
    return (
      <div className="h-full flex flex-col bg-slate-50 p-10 overflow-y-auto">
         <div className="max-w-4xl mx-auto w-full space-y-10">
            <div>
              <h1 className="text-4xl font-extrabold text-slate-900 tracking-tight">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</h1>
              <p className="text-slate-500 mt-2 text-lg">–õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</p>
            </div>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                <Card className="p-8">
                  <h3 className="text-xl font-bold text-slate-900 mb-6 flex items-center gap-3">
                    <div className="bg-blue-100 p-2 rounded-lg"><User size={20} className="text-blue-600"/></div>
                    –õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                  </h3>
                  <div className="space-y-6">
                    <div>
                      <label className="block text-sm font-semibold text-slate-700 mb-2">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                      <input 
                        value={profileName}
                        onChange={(e) => setProfileName(e.target.value)}
                        className="w-full p-3.5 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 transition-all font-medium"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-semibold text-slate-700 mb-2">Email</label>
                      <input 
                        value={user.email}
                        readOnly
                        className="w-full p-3.5 border border-slate-200 bg-slate-50/50 rounded-xl outline-none text-slate-500"
                      />
                    </div>
                    <Button onClick={() => {setUser({...user, name: profileName}); showToast('–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω');}}>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</Button>
                  </div>
                </Card>

                <Card className="p-8">
                  <h3 className="text-xl font-bold text-slate-900 mb-6 flex items-center gap-3">
                    <div className="bg-blue-100 p-2 rounded-lg"><Shield size={20} className="text-blue-600"/></div>
                    –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
                  </h3>
                  <div className="space-y-6">
                    <div>
                      <label className="block text-sm font-semibold text-slate-700 mb-2">–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å</label>
                      <input type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" className="w-full p-3.5 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 transition-all" />
                    </div>
                    <div>
                      <label className="block text-sm font-semibold text-slate-700 mb-2">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                      <input type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" className="w-full p-3.5 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 transition-all" />
                    </div>
                    <Button variant="secondary" onClick={() => showToast('–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω')}>–û–±–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å</Button>
                  </div>
                </Card>
            </div>
         </div>
      </div>
    );
  };

  // --- Main Render ---

  if (!isAuthenticated) return renderAuthScreen();

  return (
    <div className="flex h-screen w-full overflow-hidden bg-slate-50 font-sans text-slate-900">
      {toast && <Toast message={toast} onClose={() => setToast(null)} />}
      {showProjectModal && (
         <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
            <div className="bg-white rounded-3xl shadow-2xl w-full max-w-lg p-6 space-y-6 animate-in fade-in zoom-in duration-200">
               <div className="flex justify-between items-center border-b border-slate-100 pb-4">
                  <h3 className="text-xl font-bold">–ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</h3>
                  <button onClick={()=>setShowProjectModal(false)}><X className="text-slate-400 hover:text-slate-600"/></button>
               </div>
               <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-semibold mb-2">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                    <input placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–æ–π –±–ª–æ–≥" className="w-full p-3 border rounded-xl focus:ring-2 focus:ring-blue-500 outline-none" value={newProjectData.name} onChange={e=>setNewProjectData({...newProjectData, name:e.target.value})}/>
                  </div>
                  <div>
                    <label className="block text-sm font-semibold mb-2">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea placeholder="–û —á–µ–º –ø—Ä–æ–µ–∫—Ç?" className="w-full p-3 border rounded-xl focus:ring-2 focus:ring-blue-500 outline-none h-24 resize-none" value={newProjectData.description} onChange={e=>setNewProjectData({...newProjectData, description:e.target.value})}/>
                  </div>
                  <div>
                    <label className="block text-sm font-semibold mb-2">–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è</label>
                    <input placeholder="–ö—Ç–æ –≤–∞—à–∏ –∫–ª–∏–µ–Ω—Ç—ã?" className="w-full p-3 border rounded-xl focus:ring-2 focus:ring-blue-500 outline-none" value={newProjectData.targetAudience} onChange={e=>setNewProjectData({...newProjectData, targetAudience:e.target.value})}/>
                  </div>
                  <div>
                     <label className="block text-sm font-semibold mb-2">–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã</label>
                     <div className="flex gap-2 flex-wrap">
                        {['telegram','instagram','youtube', 'tiktok', 'blog', 'linkedin'].map(p=>(
                           <button key={p} onClick={()=>setNewProjectData(prev=>({...prev, platforms: prev.platforms.includes(p)?prev.platforms.filter(x=>x!==p):[...prev.platforms, p]}))} className={`px-3 py-1 rounded-lg border text-sm capitalize ${newProjectData.platforms.includes(p)?'bg-blue-600 text-white border-blue-600':'bg-white text-slate-600'}`}>{p}</button>
                        ))}
                     </div>
                  </div>
                  <div>
                    <label className="block text-sm font-semibold mb-2">–¢–æ–Ω</label>
                    <select className="w-full p-3 border rounded-xl focus:ring-2 focus:ring-blue-500 outline-none bg-white" value={newProjectData.tone} onChange={e=>setNewProjectData({...newProjectData, tone:e.target.value})}>
                      <option value="friendly">–î—Ä—É–∂–µ–ª—é–±–Ω—ã–π</option>
                      <option value="professional">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π</option>
                      <option value="bold">–î–µ—Ä–∑–∫–∏–π</option>
                      <option value="formal">–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π</option>
                    </select>
                  </div>
               </div>
               <div className="flex justify-end gap-2 pt-4 border-t border-slate-100">
                  <Button variant="secondary" onClick={()=>setShowProjectModal(false)}>–û—Ç–º–µ–Ω–∞</Button>
                  <Button onClick={handleSaveNewProject}>–°–æ–∑–¥–∞—Ç—å</Button>
               </div>
            </div>
         </div>
      )}

      {/* Sidebar */}
      <aside className="w-72 bg-white border-r border-slate-200 flex flex-col flex-shrink-0 z-20">
        <div className="h-20 flex items-center px-8 border-b border-slate-100">
          <div className="w-10 h-10 bg-blue-600 text-white rounded-xl flex items-center justify-center mr-3 shadow-lg shadow-blue-200">
            <Feather size={20} />
          </div>
          <span className="font-extrabold text-xl tracking-tight text-slate-900">–ì–ª–∞–≤—Ä–µ–¥</span>
        </div>
        
        <nav className="p-6 space-y-2 flex-1 overflow-y-auto">
          <button onClick={() => setActiveTab('projects')} className={`w-full flex items-center px-4 py-3.5 rounded-xl text-sm font-semibold transition-all ${activeTab === 'projects' ? 'bg-blue-50 text-blue-700' : 'text-slate-500 hover:bg-slate-50'}`}>
            <Folder size={20} className="mr-3"/> –ü—Ä–æ–µ–∫—Ç—ã
          </button>
          
          <button onClick={() => setActiveTab('plan')} className={`w-full flex items-center px-4 py-3.5 rounded-xl text-sm font-semibold transition-all ${activeTab === 'plan' ? 'bg-blue-50 text-blue-700' : 'text-slate-500 hover:bg-slate-50'}`}>
            <CalendarIcon size={20} className="mr-3"/> –û–±—â–∏–π –ø–ª–∞–Ω
          </button>

          <button onClick={() => setActiveTab('ideas')} className={`w-full flex items-center px-4 py-3.5 rounded-xl text-sm font-semibold transition-all ${activeTab === 'ideas' ? 'bg-blue-50 text-blue-700' : 'text-slate-500 hover:bg-slate-50'}`}>
            <Zap size={20} className="mr-3"/> –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–¥–µ–π
          </button>
          
          <div className="pt-8 pb-3 px-4 text-xs font-bold text-slate-400 uppercase tracking-widest">–ê–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–µ–∫—Ç</div>
          {activeTab === 'project_view' || activeTab === 'editor' ? (
            <div className="space-y-1">
               <div className="px-4 py-2 text-sm font-bold text-slate-800 truncate mb-1 border-l-2 border-blue-500 pl-4 ml-4">{activeProject.name}</div>
               <button onClick={() => {setActiveTab('project_view'); setProjectSubTab('plan')}} className={`w-full flex items-center px-4 py-2.5 rounded-xl text-sm font-medium transition-all ${projectSubTab === 'plan' && activeTab !== 'editor' ? 'text-blue-700 bg-blue-50' : 'text-slate-500 hover:text-slate-900'}`}>–ö–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω</button>
               <button onClick={() => {setActiveTab('project_view'); setProjectSubTab('ideas')}} className={`w-full flex items-center px-4 py-2.5 rounded-xl text-sm font-medium transition-all ${projectSubTab === 'ideas' && activeTab !== 'editor' ? 'text-blue-700 bg-blue-50' : 'text-slate-500 hover:text-slate-900'}`}>–ë–∞–Ω–∫ –∏–¥–µ–π</button>
               <button onClick={handleDeleteProject} className="w-full flex items-center px-4 py-2.5 rounded-xl text-xs font-medium text-red-500 hover:bg-red-50 mt-4"><Trash2 size={14} className="mr-2"/> –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
            </div>
          ) : (
            <div className="px-6 py-4 rounded-xl border border-dashed border-slate-200 bg-slate-50 text-center text-xs text-slate-400">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç</div>
          )}
        </nav>

        <div className="p-6 border-t border-slate-100">
          <div className="flex items-center gap-3 mb-4 cursor-pointer p-3 rounded-2xl hover:bg-slate-50 transition-all border border-transparent hover:border-slate-200" onClick={() => setActiveTab('profile')}>
            <Avatar name={user?.name} />
            <div className="overflow-hidden">
              <div className="text-sm font-bold text-slate-900 truncate">{user?.name}</div>
              <div className="text-xs text-emerald-600 font-medium flex items-center gap-1">
                <CheckCircle2 size={10} className="fill-emerald-600 text-white"/> Full Access
              </div>
            </div>
            <Settings size={16} className="ml-auto text-slate-300"/>
          </div>
          <button onClick={handleLogout} className="w-full flex items-center justify-center gap-2 text-slate-500 hover:text-red-600 hover:bg-red-50 py-3 rounded-xl text-sm font-semibold transition-all">
            <LogOut size={18} /> –í—ã–π—Ç–∏
          </button>
        </div>
      </aside>

      {/* Main Content */}
      <main className="flex-1 flex flex-col min-w-0 overflow-hidden relative shadow-inner">
        {activeTab === 'projects' && renderGlobalProjectsView()}
        {activeTab === 'plan' && renderGlobalCalendarView()}
        {activeTab === 'ideas' && renderGlobalIdeasView()}
        {activeTab === 'project_view' && renderProjectView()}
        {activeTab === 'editor' && renderEditorView()}
        {activeTab === 'profile' && renderProfileView()}
        
        {/* Floating Action Button */}
        {activeTab === 'projects' && (
          <div className="absolute bottom-10 right-10 z-30">
            <button 
              onClick={() => {
                setNewProjectData({ name: '', description: '', targetAudience: '', tone: 'friendly', platforms: [] });
                setShowProjectModal(true);
              }}
              className="bg-blue-600 text-white p-5 rounded-full shadow-2xl shadow-blue-600/40 hover:bg-blue-700 hover:scale-110 active:scale-95 transition-all flex items-center gap-3 pr-7 group"
            >
              <div className="bg-blue-500 rounded-full p-1 group-hover:bg-blue-400 transition-colors"><Plus size={24} /></div>
              <span className="font-bold text-lg">–ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</span>
            </button>
          </div>
        )}
      </main>
    </div>
  );
}